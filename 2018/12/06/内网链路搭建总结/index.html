<!doctype html>
<html lang="en">
<head>
    <head>
    <!-- Require Meta -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <!-- Font-awsome CSS-->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
    <!-- hightlight.js -->
    <link rel="stylesheet" href="/css/style.css">
    <link rel="icon" href="/images/favicon.ico">
    <!-- title -->
    <title>y4ngyy</title>
</head>
</head>
<body>
<div class="sidebar-container">
<div class="sidebar rounded">
    <!--头像区域-->
    <div class="head bg-dark text-center rounded-bottom">
        <a href="#">
            <img src="/images/avatar.jpg" alt="avatar.jpg">
        </a>
        <h2 class="text-light mt-4">y4ngyy</h2>
    </div>
    <!--个人描述-->
    <section class="text-center text-dark p-lg-5 p-3" id="description"><h4 class="m-0">无所事事,游手好闲</h4></section>
    <!--导航条-->
    <nav>
        <p  class="nav-clapse fa fa-bars text-center"></p>
        <ul class="nav flex-column text-center">
            
            <li class="nav-item">
                <a href="/" class="nav-link text-secondary">Home</a>
            </li>
            
            <li class="nav-item">
                <a href="/archives" class="nav-link text-secondary">Archives</a>
            </li>
            
            <li class="nav-item">
                <a href="/category" class="nav-link text-secondary">Category</a>
            </li>
            
        </ul>
    </nav>
</div>
</div>
<div class="content-container">
    <div class="content shadow rounded">
        <h2 class="text-center">内网链路搭建总结</h2>
        <div class="text-center">
            <i class="fa fa-calendar"></i>
            <span>2018-12-06</span>
        </div>
        <hr width="90%" color="#ddd">
        <article>
                <p>参加xnuca的线下赛，多级的内网环境使得比赛体验很差，特此总结一下链路的搭建。</p>
<h2 id="一级"><a href="#一级" class="headerlink" title="一级"></a>一级</h2><p>一级链路为个人PC通过跳板机访问内网的服务，一般提供ssh的用户密码，指令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -2 -D 2335 iiebc@xx.xxx.xx.xx</span><br></pre></td></tr></table></figure>
<p>然后便可以配置proxychains（/etc/proxychains.conf）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socks5 127.0.0.1 2335</span><br></pre></td></tr></table></figure>
<p>通过proxychains或者浏览器中挂代理(socks5)的形式来访问内网服务。<br>比赛中有另一种情况，个人PC是windows系统时，需要使用linux虚拟机来ssh搭接链路，所以要挂在<code>0.0.0.0</code>上：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -2 -D 0.0.0.0:2335 iiebc@xx.xxx.xx.xx</span><br></pre></td></tr></table></figure>
<p>然后就可以正常在windows浏览器上挂上虚拟机IP代理，全局的话，尝试使用proxifier，用不了……</p>
<h2 id="二级"><a href="#二级" class="headerlink" title="二级"></a>二级</h2><p>二级链路是个人PC要通过跳板机连接攻击机再访问靶机，ssh方式比较稳定，但在只有webshell的情况下也只能用ew之类的不稳定服务。<br>总结一下ssh，先ssh连接跳板机：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -L 1080:127.0.0.1:2335 iiebc@10.xxx.1.10</span><br></pre></td></tr></table></figure>
<p>然后在跳板机上连接攻击机：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -2 -D 2335 attacker@10.xxx.1.30</span><br></pre></td></tr></table></figure>
<p>proxychains：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">socks5 127.0.0.1 1080</span><br></pre></td></tr></table></figure>
<h2 id="多级"><a href="#多级" class="headerlink" title="多级"></a>多级</h2><p>多级链路应该按照二级链路的思路，一一端口映射过来，应该可以打通，没有试过……</p>

        </article>
        <hr width="90%" color="#ddd">
    </div>
    <div class="content text-center mb-2"><span>Powered By Hexo | theme: <a href="https://github.com/y4ngyy/hexo-theme-yyang">yyang</a></span></div>
<script
        src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous"></script>
<script src="/js/highlight.pack.js"></script>
<script src="/js/nav.js"></script>
<script>
    $(document).ready(function() {
        $('figure').each(function(i, block) {
            hljs.highlightBlock(block);
        });
    });
</script>
</div>
</body>
</html>